<div class="nueva-motocicleta-container">
<div class="bg-background rounded-2xl shadow-lg border">
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-6 rounded-t-2xl">
          <h2 class="text-2xl font-bold text-white">üÜï  Nueva Motocicleta</h2>
          <p class="text-blue-100 mt-1">Completa estos datos sencillos</p>
        </div>

 <form [formGroup]="requestForm" (ngSubmit)="submitRequest()" class="p-6 space-y-6">
          
          <!-- Datos B√°sicos -->
          <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-foreground mb-4">üìù Datos de la Motocicleta</h3>
            
            <div class="grid gap-6 md:grid-cols-2">
              <div>
                <label class="block text-sm font-bold text-foreground mb-3">üîñ N√∫mero de Placa</label>
                <input
                  type="text"
                  formControlName="licensePlate"
                  placeholder="Ejemplo: ABC123"
                  (input)="onLicensePlateInput($event)"
                  class="w-full px-4 py-3 text-lg font-bold text-center bg-yellow-100 border-2 border-yellow-300 rounded-xl uppercase tracking-wider focus:outline-none focus:ring-4 focus:ring-primary/20"
                  maxlength="6">
                @if (requestForm.get('licensePlate')?.invalid && requestForm.get('licensePlate')?.touched) {
                  <div class="mt-2 p-3 bg-destructive/10 text-destructive rounded-lg text-sm">
                    ‚ùå La placa debe tener entre 5 y 6 caracteres (letras y n√∫meros)
                  </div>
                }
              </div>

              <div>
                <label class="block text-sm font-bold text-foreground mb-3">‚öôÔ∏è Cilindraje (cc)</label>
                <input
                  type="number"
                  formControlName="cylinderCapacity"
                  placeholder="Ej: 150"
                  min="50"
                  class="w-full px-4 py-3 text-lg font-bold text-center bg-blue-100 border-2 border-blue-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-primary/20">
                @if (requestForm.get('cylinderCapacity')?.invalid && requestForm.get('cylinderCapacity')?.touched) {
                  <div class="mt-2 p-3 bg-destructive/10 text-destructive rounded-lg text-sm">
                    ‚ùå El cilindraje debe ser 50 o m√°s
                  </div>
                }
              </div>

              <div>
                <label class="block text-sm font-bold text-foreground mb-3">üõ£Ô∏è Kil√≥metros Actuales</label>
                <div class="relative">
                  <input
                    type="number"
                    formControlName="currentMileage"
                    placeholder="0"
                    min="0"
                    class="w-full px-4 py-3 text-lg font-bold text-center bg-green-100 border-2 border-green-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-primary/20">
                  <span class="absolute right-4 top-3 text-lg font-bold text-gray-600">km</span>
                </div>
                @if (requestForm.get('currentMileage')?.invalid && requestForm.get('currentMileage')?.touched) {
                  <div class="mt-2 p-3 bg-destructive/10 text-destructive rounded-lg text-sm">
                    ‚ùå Los kil√≥metros deben ser 0 o m√°s
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Selecci√≥n de Motocicleta -->
          <div class="bg-blue-50 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-foreground mb-4">üèçÔ∏è Elegir Motocicleta</h3>
            
            @if (selectedMotorcycle()) {
              <div class="bg-green-100 border-2 border-green-300 rounded-xl p-4 mb-4">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-bold text-lg text-green-800">‚úÖ Motocicleta Seleccionada:</h4>
                    <div class="mt-2">
                      <span class="text-xl font-bold text-green-900">{{ selectedMotorcycle()!.brand }} {{ selectedMotorcycle()!.model }}</span>
                      <div class="flex gap-2 mt-1">
                        <span class="bg-background px-2 py-1 rounded-lg text-sm">üìÖ {{ selectedMotorcycle()!.year }}</span>
                        <span class="bg-background px-2 py-1 rounded-lg text-sm">‚öôÔ∏è {{ selectedMotorcycle()!.displacementCc }}cc</span>
                      </div>
                    </div>
                  </div>
                  <button 
                    type="button"
                    (click)="clearMotorcycleSelection()"
                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">
                    ‚ùå Cambiar
                  </button>
                </div>
              </div>
            } @else {
              <button
                type="button"
                (click)="toggleMotorcycleSelection()"
                class="w-full p-6 border-2 border-dashed border-blue-300 rounded-xl text-blue-700 hover:bg-blue-100 transition-all">
                <div class="text-center">
                  <div class="text-4xl mb-2">üîç</div>
                  <span class="text-lg font-semibold">Buscar y Elegir Motocicleta</span>
                  <p class="text-sm mt-1">Haz clic aqu√≠ para ver todas las motocicletas disponibles</p>
                </div>
              </button>
            }

            @if (showMotorcycleGrid()) {
              <div class="mt-6 bg-background rounded-xl p-6 border-2 border-primary/20">
                
                <!-- Integrated Motorcycle Filters -->
                <app-motorcycle-filters
                  [availableBrands]="availableBrands()"
                  [availableTypes]="[]"
                  [availableYears]="availableYears()"
                  [resultCount]="filteredMotorcycles().length"
                  [loading]="false"
                  [compact]="false"
                  [showAdvancedFilters]="true"
                  [placeholder]="'Buscar por marca o modelo...'"
                  [debounceTime]="300"
                  (filtersChanged)="onFiltersChanged($event)">
                </app-motorcycle-filters>

                <!-- Additional Model Filter -->
                <div class="mb-6">
                  <label class="block text-sm font-bold text-foreground mb-2">üèçÔ∏è Modelo</label>
                  <select
                    [value]="modelFilter()"
                    (change)="filterByModel($any($event.target).value)"
                    class="w-full px-4 py-3 bg-background border-2 border-border rounded-xl text-lg focus:outline-none focus:ring-4 focus:ring-primary/20">
                    <option value="">Todos los modelos</option>
                    @for(model of availableModels(); track model) {
                      <option [value]="model">{{ model }}</option>
                    }
                  </select>
                </div>

                @if (filteredMotorcycles().length === 0) {
                  <div class="text-center py-12">
                    <div class="text-4xl mb-4">üòï</div>
                    <p class="text-lg font-semibold text-muted-foreground">No encontramos motocicletas</p>
                    <p class="text-gray-500 mt-2">Prueba buscando con otros filtros</p>
                  </div>
                } @else {
                  <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 max-h-96 overflow-y-auto">
                    @for (motorcycle of filteredMotorcycles(); track motorcycle.id) {
                      <div 
                        (click)="selectMotorcycle(motorcycle)"
                        class="bg-gray-50 border-2 border-gray-200 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all cursor-pointer">
                        <div class="text-center">
                          <div class="text-2xl mb-2">üèçÔ∏è</div>
                          <h4 class="font-bold text-lg text-foreground mb-2">
                            {{ motorcycle.brand }} {{ motorcycle.model }}
                          </h4>
                          <div class="flex justify-center gap-2 mb-3">
                            <span class="bg-background px-2 py-1 rounded-lg text-xs font-medium border">üìÖ {{ motorcycle.year }}</span>
                            <span class="bg-background px-2 py-1 rounded-lg text-xs font-medium border">‚öôÔ∏è {{ motorcycle.displacementCc }}cc</span>
                          </div>
                          @if (motorcycle.description) {
                            <p class="text-sm text-gray-600">{{ motorcycle.description }}</p>
                          }
                        </div>
                      </div>
                    }
                  </div>
                }

                <div class="text-center mt-6">
                  <button
                    type="button"
                    (click)="toggleMotorcycleSelection()"
                    class="px-6 py-3 bg-gray-200 text-muted-foreground rounded-xl font-semibold hover:bg-gray-300">
                    ‚ùå Cerrar B√∫squeda
                  </button>
                </div>
              </div>
            }

            @if (requestForm.get('motorcycleId')?.invalid && requestForm.get('motorcycleId')?.touched) {
              <div class="mt-3 p-3 bg-destructive/10 text-destructive rounded-lg text-sm">
                ‚ùå Debes elegir una motocicleta
              </div>
            }
          </div>

         

          <!-- Informaci√≥n Simple -->
          <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-6">
            <div class="flex items-start gap-4">
              <div class="text-3xl">üí°</div>
              <div>
                <h4 class="font-bold text-yellow-800 mb-2">Recuerda:</h4>
                <ul class="text-yellow-800 space-y-1 text-sm">
          
            <li>‚úÖ Escribe bien la placa y los kil√≥metros</li>
            <li>‚úÖ Elige la motocicleta correcta</li>
          </ul>
        </div>
      </div>
    </div>

      <!-- Botones Grandes -->
          <div class="flex gap-4 pt-6">
            
            <button 
              type="submit" 
              [disabled]="isSubmitting() || requestForm.invalid" 
              class="flex-1 py-4 bg-green-600 text-white text-lg rounded-xl font-bold hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
              @if(isSubmitting()) { 
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white"></div>
                Enviando...
              } @else {
                ‚úÖ Nueva Motocicleta
              }
            </button>
          </div>
        </form>
      </div>
    