<div class="wait-ticket">
  <!-- Header -->
  <header class="wait-ticket__header">
    <div class="wait-ticket__logo-section">
      <h1 class="wait-ticket__title">Blue Dragon Motors</h1>
      <p class="wait-ticket__subtitle">Ticket de Cola Digital</p>
    </div>
    <div class="wait-ticket__status-badge" [class]="getStatusColor(queueStatus())">
      {{ getStatusText(queueStatus()) }}
    </div>
  </header>

  <!-- Main Ticket Content -->
  <div class="wait-ticket__content">
    <!-- Queue Information -->
    <div class="wait-ticket__queue-info">
      <div class="wait-ticket__info-row">
        <div class="wait-ticket__info-item">
          <label class="wait-ticket__info-label">Posición en Cola</label>
          <span class="wait-ticket__position-number">#{{ queuePosition() }}</span>
        </div>
        <div class="wait-ticket__info-item">
          <label class="wait-ticket__info-label">Tiempo Estimado</label>
          <span class="wait-ticket__wait-time">{{ formatWaitTime(estimatedWaitTime()) }}</span>
        </div>
      </div>

      <div class="wait-ticket__info-row">
        <div class="wait-ticket__info-item">
          <label class="wait-ticket__info-label">Código de Verificación</label>
          <span class="wait-ticket__verification-code">{{ verificationCode() }}</span>
        </div>
        <div class="wait-ticket__info-item">
          <label class="wait-ticket__info-label">Hora de Emisión</label>
          <span class="wait-ticket__issue-time">{{ currentTime() | date:'HH:mm' }}</span>
        </div>
      </div>
    </div>

    <!-- QR Code Section -->
    <div class="wait-ticket__qr-section">
      <h3 class="wait-ticket__qr-title">Tu Código QR Personal</h3>
      <p class="wait-ticket__qr-description">Presenta este código al técnico cuando te llamen</p>

      @if (qrCodeDataUrl()) {
        <div class="wait-ticket__qr-code-container">
          <img [src]="qrCodeDataUrl()" alt="Código QR de seguimiento" class="wait-ticket__qr-code" />
          <button type="button" class="wait-ticket__download-qr wait-ticket__btn-icon" (click)="downloadQR()" title="Descargar QR">
            <i class="icon-download"></i>
          </button>
        </div>
      } @else {
        <div class="wait-ticket__qr-loading">
          <div class="wait-ticket__qr-spinner"></div>
          <p class="wait-ticket__qr-loading-text">Generando código QR...</p>
        </div>
      }
    </div>

    <!-- Services Summary -->
    <div class="wait-ticket__services-summary">
      <h3 class="wait-ticket__services-title">Servicios Solicitados</h3>
      <div class="wait-ticket__services-list">
        @for (service of ticketData().selectedServices; track service.id) {
          <div class="wait-ticket__service-item">
            <div class="wait-ticket__service-info">
              <span class="wait-ticket__service-name">{{ service.title }}</span>
              <span class="wait-ticket__service-price">
                @if (service.price && service.price > 0) {
                  ${{ service.price.toLocaleString('es-CO') }}
                } @else {
                  Por cotización
                }
              </span>
            </div>
            @if (service.estimatedHours) {
              <span class="wait-ticket__service-duration">{{ service.estimatedHours }}h</span>
            }
          </div>
        }
      </div>

      @if (ticketData().totalCost > 0) {
        <div class="wait-ticket__total-cost">
          <strong>Costo Total Estimado: ${{ ticketData().totalCost.toLocaleString('es-CO') }}</strong>
        </div>
      }
    </div>

    <!-- Technician Assignment -->
    @if (assignedTechnician()) {
      <div class="wait-ticket__technician-assignment">
        <h3 class="wait-ticket__technician-title">Técnico Asignado</h3>
        <div class="wait-ticket__technician-info">
          <i class="icon-technician"></i>
          <span>ID del Técnico: {{ assignedTechnician() }}</span>
        </div>
        <p class="wait-ticket__assignment-note">Tu técnico te llamará cuando esté listo para atenderte.</p>
      </div>
    }

    <!-- Real-time Status Updates -->
    <div class="wait-ticket__status-updates">
      <h3 class="wait-ticket__status-title">Estado Actual</h3>
      <div class="wait-ticket__status-timeline">
        <div class="wait-ticket__timeline-item" [class.wait-ticket__timeline-item--active]="queueStatus() === 'waiting'">
          <div class="wait-ticket__timeline-marker"></div>
          <div class="wait-ticket__timeline-content">
            <h4 class="wait-ticket__timeline-step-title">En Espera</h4>
            <p class="wait-ticket__timeline-step-description">Esperando ser llamado por el técnico</p>
          </div>
        </div>
        <div class="wait-ticket__timeline-item" [class.wait-ticket__timeline-item--active]="queueStatus() === 'called'">
          <div class="wait-ticket__timeline-marker"></div>
          <div class="wait-ticket__timeline-content">
            <h4 class="wait-ticket__timeline-step-title">Llamado</h4>
            <p class="wait-ticket__timeline-step-description">El técnico te está llamando</p>
          </div>
        </div>
        <div class="wait-ticket__timeline-item" [class.wait-ticket__timeline-item--active]="queueStatus() === 'in_service'">
          <div class="wait-ticket__timeline-marker"></div>
          <div class="wait-ticket__timeline-content">
            <h4 class="wait-ticket__timeline-step-title">En Servicio</h4>
            <p class="wait-ticket__timeline-step-description">Tu motocicleta está siendo atendida</p>
          </div>
        </div>
        <div class="wait-ticket__timeline-item" [class.wait-ticket__timeline-item--active]="queueStatus() === 'served'">
          <div class="wait-ticket__timeline-marker"></div>
          <div class="wait-ticket__timeline-content">
            <h4 class="wait-ticket__timeline-step-title">Servicio Completado</h4>
            <p class="wait-ticket__timeline-step-description">El servicio ha sido completado</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="wait-ticket__actions">
    <div class="wait-ticket__action-buttons">
      <button type="button" class="wait-ticket__btn-secondary wait-ticket__action-btn" (click)="saveToWallet()">
        <i class="icon-wallet"></i>
        Guardar en Billetera
      </button>
      <button type="button" class="wait-ticket__btn-secondary wait-ticket__action-btn" (click)="shareTicket()">
        <i class="icon-share"></i>
        Compartir
      </button>
    </div>

    @if (showNavigation()) {
      <div class="wait-ticket__navigation-buttons">
        <button type="button" class="wait-ticket__btn-outline" (click)="navigateBack()">
          Volver al Seguimiento
        </button>
        <button type="button" class="wait-ticket__btn-primary" (click)="goToQueueTracking()">
          Ver Estado de Cola
        </button>
      </div>
    }
  </div>

  <!-- Footer -->
  <footer class="wait-ticket__footer">
    <p class="wait-ticket__footer-text">Blue Dragon Motors - Servicio de Calidad</p>
    <p class="wait-ticket__footer-note">Guarda este ticket digital para un servicio más rápido</p>
  </footer>

  <!-- Loading Overlay -->
  @if (isLoading()) {
    <div class="wait-ticket__loading-overlay">
      <div class="wait-ticket__spinner"></div>
      <p class="wait-ticket__loading-text">Actualizando...</p>
    </div>
  }

  <!-- Error Display -->
  @if (error()) {
    <div class="wait-ticket__error-message">
      <i class="icon-error"></i>
      {{ error() }}
    </div>
  }
</div>