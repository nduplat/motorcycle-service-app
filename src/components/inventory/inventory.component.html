<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Inventario de Repuestos</h1>
    @if(canAddProducts()) {
      <div class="flex items-center gap-2">
        <a routerLink="/admin/scanner" class="flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-md font-medium hover:bg-secondary/80">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span>Escanear con IA</span>
        </a>
        <a routerLink="/admin/products/new" class="px-4 py-2 bg-primary text-primary-foreground rounded-md font-medium hover:bg-primary/90">
          Añadir Producto
        </a>
      </div>
    }
  </div>

  <!-- Filter section -->
  <div class="bg-card rounded-xl border border-border p-4 mb-6 flex flex-col sm:flex-row gap-4 items-center">
    <div class="flex-grow w-full">
      <label for="search" class="sr-only">Buscar productos</label>
      <input 
        id="search"
        type="text"
        placeholder="Buscar por nombre..."
        [value]="searchTerm()"
        (input)="updateSearchTerm($event)"
        class="w-full px-3 py-2 bg-input border border-border rounded-md text-sm"
      >
    </div>
    <div class="w-full sm:w-64">
      <label for="category" class="sr-only">Filtrar por categoría</label>
      <select 
        id="category"
        [value]="selectedCategoryId()"
        (change)="updateCategory($event)"
        class="w-full px-3 py-2 bg-input border border-border rounded-md text-sm"
      >
        <option value="">Todas las Categorías</option>
        @for (category of categories(); track category.id) {
          <option [value]="category.id">{{ category.name }}</option>
        }
      </select>
    </div>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    @for (product of products(); track product.id) {
      <div class="bg-card rounded-xl border border-border shadow-sm overflow-hidden flex flex-col">
        <div class="aspect-square w-full overflow-hidden">
          <img [src]="product.images?.[0] || 'https://picsum.photos/400/400'" [alt]="product.name" class="w-full h-full object-cover">
        </div>
        <div class="p-4 flex flex-col flex-grow">
          <h2 class="text-lg font-semibold text-foreground truncate">{{ product.name }}</h2>
          <p class="text-sm text-muted-foreground mb-2">{{ product.brand }}</p>
          <p class="text-sm text-muted-foreground flex-grow mb-4">{{ product.description }}</p>
          
          <div class="flex justify-between items-center text-sm mb-4">
            <span class="font-mono text-muted-foreground bg-secondary px-2 py-1 rounded">{{ product.sku }}</span>
            <span [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getStockBadgeClass(product.stock)">
              Existencias: {{ product.stock }}
            </span>
          </div>

          <div class="text-xl font-bold text-primary text-right">
            {{ formatCurrency(product.sellingPrice) }}
          </div>
        </div>
      </div>
    } @empty {
      <p class="col-span-full text-center text-muted-foreground py-16">No se encontraron productos que coincidan con los filtros.</p>
    }
  </div>
</div>