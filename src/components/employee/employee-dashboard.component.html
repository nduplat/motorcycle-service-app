<div class="employee-dashboard">
  <app-header></app-header>

  <!-- Offline/Sync Status Bar -->
  <div class="status-bar" [class.offline]="!isOnline()" [class.sync-error]="syncStatus().lastSyncError">
    <div class="status-indicators">
      <!-- Connection Status -->
      <div class="status-item connection-status">
        <mat-icon [class]="getConnectionStatusColor()">{{ isOnline() ? 'wifi' : 'wifi_off' }}</mat-icon>
        <span class="status-text">{{ getConnectionStatusText() }}</span>
      </div>

      <!-- Sync Status -->
      <div class="status-item sync-status" *ngIf="syncStatus().pendingOperations > 0 || syncStatus().syncInProgress">
        <mat-icon [class]="getSyncStatusColor()">
          {{ syncStatus().syncInProgress ? 'sync' : 'sync_problem' }}
        </mat-icon>
        <span class="status-text">{{ getSyncStatusText() }}</span>
        <button mat-icon-button
                *ngIf="!syncStatus().syncInProgress"
                (click)="performManualSync()"
                [disabled]="loadingStates().sync"
                matTooltip="Sincronizar ahora">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>

      <!-- Cache Refresh -->
      <div class="status-item cache-status">
        <button mat-icon-button
                (click)="forceRefreshCache()"
                [disabled]="loadingStates().sync || !isOnline()"
                matTooltip="Actualizar caché">
          <mat-icon>cloud_download</mat-icon>
        </button>
      </div>
    </div>

    <!-- Last Sync Time -->
    <div class="last-sync-info" *ngIf="syncStatus().lastSyncTime">
      <mat-icon>schedule</mat-icon>
      <span>Última sync: {{ syncStatus().lastSyncTime | date:'short' }}</span>
    </div>
  </div>

  <div class="dashboard-content">
    <mat-tab-group [(selectedIndex)]="activeTabIndex" (selectedTabChange)="onTabChange($event.index)">
      <mat-tab label="Mis Trabajos">
        <div class="tab-content">
          <!-- Filter Chips -->
          <div class="filters-section">
            <mat-chip-set>
              <mat-chip
                *ngFor="let filter of filterOptions"
                [selected]="selectedFilter() === filter.value"
                (click)="onFilterChange(filter.value)"
                [class.selected]="selectedFilter() === filter.value">
                {{ filter.label }}
              </mat-chip>
            </mat-chip-set>
          </div>

          <!-- Search Bar -->
          <div class="search-section">
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>Buscar por placa, cliente u orden</mat-label>
              <input matInput
                     [value]="searchQuery()"
                     (input)="onSearchChange($event.target.value)"
                     placeholder="Buscar...">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
          </div>

          <!-- Work Orders Grid -->
          <div class="work-orders-grid">
            <mat-card *ngFor="let workOrder of filteredJobs(); trackBy: trackByWorkOrderId"
                      class="work-order-card"
                      [class.in-progress]="workOrder.status === 'in_progress'"
                      [class.waiting-parts]="workOrder.status === 'waiting_parts'">

              <!-- Card Header with Priority Badge -->
              <mat-card-header>
                <div class="card-header-content">
                  <div class="order-info">
                    <span class="order-number">{{ workOrder.number || 'Sin número' }}</span>
                    <mat-chip [color]="getPriorityBadge(workOrder).color" class="priority-badge">
                      {{ getPriorityBadge(workOrder).text }}
                    </mat-chip>
                  </div>
                  <mat-chip [color]="getStatusColor(workOrder.status)" class="status-chip">
                    {{ getStatusText(workOrder.status) }}
                  </mat-chip>
                </div>
              </mat-card-header>

              <!-- Progress Bar -->
              <mat-card-content>
                <div class="progress-section">
                  <span class="progress-label">Progreso</span>
                  <mat-progress-bar
                    mode="determinate"
                    [value]="getProgressPercentage(workOrder)"
                    class="progress-bar">
                  </mat-progress-bar>
                  <span class="progress-text">{{ getProgressPercentage(workOrder) }}%</span>
                </div>

                <!-- Client Info -->
                <div class="client-info" *ngIf="getClientInfo(workOrder.clientId)">
                  <mat-icon>person</mat-icon>
                  <div class="client-details">
                    <span class="client-name">{{ getClientInfo(workOrder.clientId)?.name || 'Cliente desconocido' }}</span>
                    <span class="client-email">{{ getClientInfo(workOrder.clientId)?.email }}</span>
                  </div>
                </div>

                <!-- Vehicle Info -->
                <div class="vehicle-info" *ngIf="getVehicleInfo(workOrder.vehicleId)">
                  <mat-icon>two_wheeler</mat-icon>
                  <div class="vehicle-details">
                    <span class="vehicle-plate">{{ getVehicleInfo(workOrder.vehicleId)?.plate || 'Sin placa' }}</span>
                    <span class="vehicle-model">{{ getVehicleInfo(workOrder.vehicleId)?.brand }} {{ getVehicleInfo(workOrder.vehicleId)?.model }}</span>
                  </div>
                </div>

                <!-- Services List -->
                <div class="services-section" *ngIf="workOrder.services && workOrder.services.length > 0">
                  <h4>Servicios</h4>
                  <div class="services-list">
                    <mat-chip *ngFor="let serviceId of workOrder.services"
                              class="service-chip"
                              [matTooltip]="getServiceInfo(serviceId)?.title || serviceId">
                      {{ getServiceInfo(serviceId)?.title || serviceId }}
                    </mat-chip>
                  </div>
                </div>

                <!-- Created Date -->
                <div class="created-date">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ workOrder.createdAt.toDate() | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
              </mat-card-content>

              <!-- Action Buttons -->
              <mat-card-actions>
                <div class="action-buttons">
                  <!-- Start Work Button -->
                  <button mat-raised-button
                          color="primary"
                          *ngIf="workOrder.status === 'open'"
                          (click)="startWorkOrder(workOrder)"
                          [disabled]="!isOnline() && !syncService.hasPendingOperations()">
                    <mat-icon>{{ !isOnline() ? 'offline_bolt' : 'iniciar' }}</mat-icon>
                    {{ !isOnline() ? 'Iniciar (Offline)' : 'Iniciar Trabajo' }}
                  </button>

                  <!-- Complete Button -->
                  <button mat-raised-button
                          color="accent"
                          *ngIf="workOrder.status === 'in_progress'"
                          (click)="completeWorkOrder(workOrder)"
                          [disabled]="!isOnline() && !syncService.hasPendingOperations()">
                    <mat-icon>{{ !isOnline() ? 'offline_bolt' : 'check_circle' }}</mat-icon>
                    {{ !isOnline() ? 'Completar (Offline)' : 'Completar' }}
                  </button>

                  <!-- Pause Button -->
                  <button mat-raised-button
                          color="warn"
                          *ngIf="workOrder.status === 'in_progress'"
                          (click)="pauseWorkOrder(workOrder)"
                          [disabled]="!isOnline() && !syncService.hasPendingOperations()">
                    <mat-icon>{{ !isOnline() ? 'offline_bolt' : 'pause' }}</mat-icon>
                    {{ !isOnline() ? 'Pausar (Offline)' : 'Pausar' }}
                  </button>

                  <!-- Photos Button -->
                  <button mat-button (click)="openPhotos(workOrder)">
                    <mat-icon>photo_camera</mat-icon>
                    Fotos
                  </button>

                  <!-- Notes Button -->
                  <button mat-button (click)="openNotes(workOrder)">
                    <mat-icon>note</mat-icon>
                    Notas
                  </button>
                </div>
              </mat-card-actions>
            </mat-card>

            <!-- Empty State -->
            <div *ngIf="filteredJobs().length === 0" class="empty-state">
              <mat-icon class="empty-icon">work_off</mat-icon>
              <h3>No hay trabajos asignados</h3>
              <p>No se encontraron trabajos que coincidan con los filtros aplicados.</p>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Cola">
        <div class="tab-content">
          <!-- Queue Statistics Panel -->
          <div class="queue-statistics-panel">
            <mat-card class="stats-card">
              <mat-card-content>
                <div class="stats-grid">
                  <div class="stat-item">
                    <div class="stat-icon">
                      <mat-icon>people</mat-icon>
                    </div>
                    <div class="stat-info">
                      <span class="stat-value">{{ queueStats().totalInQueue }}</span>
                      <span class="stat-label">En Cola</span>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <mat-icon>schedule</mat-icon>
                    </div>
                    <div class="stat-info">
                      <span class="stat-value">{{ queueStats().averageWaitTime }}</span>
                      <span class="stat-label">Tiempo Promedio (min)</span>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <mat-icon>engineering</mat-icon>
                    </div>
                    <div class="stat-info">
                      <span class="stat-value">{{ queueStats().techniciansAvailable }}</span>
                      <span class="stat-label">Técnicos Disponibles</span>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Queue Filter Chips -->
          <div class="queue-filters-section">
            <mat-chip-set>
              <mat-chip
                *ngFor="let filter of queueFilterOptions"
                [selected]="selectedQueueFilter() === filter.value"
                (click)="onQueueFilterChange(filter.value)"
                [class.selected]="selectedQueueFilter() === filter.value">
                {{ filter.label }}
              </mat-chip>
            </mat-chip-set>
          </div>

          <!-- Queue Search -->
          <div class="queue-search-section">
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>Buscar en cola</mat-label>
              <input matInput
                     [value]="queueSearchQuery()"
                     (input)="onQueueSearchChange($event.target.value)"
                     placeholder="Buscar por cliente, servicio...">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
          </div>

          <!-- Queue Entry Cards -->
          <div class="queue-entries-grid">
            <mat-card *ngFor="let entry of filteredQueueEntries(); trackBy: trackByQueueEntryId"
                      class="queue-entry-card"
                      [class.called]="entry.status === 'called'"
                      [class.waiting]="entry.status === 'waiting'">

              <!-- Card Header -->
              <mat-card-header>
                <div class="entry-header-content">
                  <div class="entry-position">
                    <span class="position-badge">#{{ entry.position }}</span>
                    <span class="wait-time">{{ getQueueEntryWaitTime(entry) }} min</span>
                  </div>
                  <mat-chip [color]="getQueueEntryStatusColor(entry.status)" class="status-chip">
                    {{ getQueueEntryStatusText(entry.status) }}
                  </mat-chip>
                </div>
              </mat-card-header>

              <!-- Card Content -->
              <mat-card-content>
                <!-- Client Info -->
                <div class="client-info" *ngIf="getQueueEntryClientInfo(entry)">
                  <mat-icon>person</mat-icon>
                  <div class="client-details">
                    <span class="client-name">{{ getQueueEntryClientInfo(entry)?.name || 'Cliente desconocido' }}</span>
                    <span class="client-email">{{ getQueueEntryClientInfo(entry)?.email }}</span>
                  </div>
                </div>

                <!-- Service Type -->
                <div class="service-info">
                  <mat-icon>build</mat-icon>
                  <div class="service-details">
                    <span class="service-type">{{ entry.serviceType === 'appointment' ? 'Cita Programada' : 'Servicio Inmediato' }}</span>
                    <span class="joined-time">{{ entry.joinedAt.toDate() | date:'short' }}</span>
                  </div>
                </div>

                <!-- Notes -->
                <div class="notes-section" *ngIf="entry.notes">
                  <mat-icon>note</mat-icon>
                  <span class="notes-text">{{ entry.notes }}</span>
                </div>

                <!-- Assigned Technician -->
                <div class="technician-info" *ngIf="entry.assignedTo">
                  <mat-icon>engineering</mat-icon>
                  <span class="technician-name">{{ entry.assignedTo }}</span>
                </div>
              </mat-card-content>

              <!-- Action Buttons -->
              <mat-card-actions>
                <div class="queue-action-buttons">
                  <button mat-raised-button
                          color="primary"
                          *ngIf="entry.status === 'waiting'"
                          (click)="callNextCustomer()"
                          [disabled]="!isOnline() && !syncService.hasPendingOperations()">
                    <mat-icon>{{ !isOnline() ? 'offline_bolt' : 'call' }}</mat-icon>
                    {{ !isOnline() ? 'LLAMAR (Offline)' : 'LLAMAR AHORA' }}
                  </button>

                  <button mat-button
                          (click)="viewQueueEntryDetails(entry)">
                    <mat-icon>visibility</mat-icon>
                    VER DETALLES
                  </button>

                  <button mat-button
                          *ngIf="entry.status === 'waiting'"
                          (click)="reassignQueueEntry(entry.id, '')">
                    <mat-icon>swap_horiz</mat-icon>
                    REASIGNAR
                  </button>
                </div>
              </mat-card-actions>
            </mat-card>

            <!-- Empty State -->
            <div *ngIf="filteredQueueEntries().length === 0" class="empty-queue-state">
              <mat-icon class="empty-icon">queue</mat-icon>
              <h3>No hay entradas en la cola</h3>
              <p>No se encontraron entradas que coincidan con los filtros aplicados.</p>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Tiempo">
        <div class="tab-content">
          <div class="time-tracking-section">
            <!-- Current Timer Section -->
            <div class="current-timer-section">
              <div class="current-timer" *ngIf="currentTimeEntry()">
                <div class="timer-header">
                  <h3>Temporizador Activo</h3>
                  <div class="timer-status" [class.paused]="isTimerPaused()">
                    <mat-icon *ngIf="isTimerPaused()">pause_circle</mat-icon>
                    <mat-icon *ngIf="!isTimerPaused()">play_circle</mat-icon>
                    <span>{{ isTimerPaused() ? 'Pausado' : 'Activo' }}</span>
                  </div>
                </div>
                <div class="timer-display">
                  <span class="elapsed-time">{{ elapsedTime() | date:'HH:mm:ss' }}</span>
                  <span class="work-order-ref">{{ getTimeEntryWorkOrderName(currentTimeEntry()!) }}</span>
                </div>
                <div class="timer-controls">
                  <button mat-raised-button
                          color="accent"
                          *ngIf="!isTimerPaused()"
                          (click)="pauseWorkTimer()">
                    <mat-icon>pause</mat-icon>
                    Pausar
                  </button>
                  <button mat-raised-button
                          color="primary"
                          *ngIf="isTimerPaused()"
                          (click)="resumeWorkTimer()">
                    <mat-icon>play_arrow</mat-icon>
                    Reanudar
                  </button>
                  <button mat-raised-button
                          color="warn"
                          (click)="stopWorkTimer()">
                    <mat-icon>stop</mat-icon>
                    Detener
                  </button>
                </div>
              </div>

              <div class="no-active-timer" *ngIf="!currentTimeEntry()">
                <mat-icon>timer_off</mat-icon>
                <h3>Sin temporizador activo</h3>
                <p>Inicia un trabajo para comenzar a rastrear el tiempo.</p>
              </div>
            </div>

            <!-- Today's Summary -->
            <div class="time-summary-section">
              <mat-card class="summary-card">
                <mat-card-header>
                  <mat-card-title>Resumen del Día</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="summary-grid">
                    <div class="summary-item">
                      <div class="summary-icon">
                        <mat-icon>schedule</mat-icon>
                      </div>
                      <div class="summary-info">
                        <span class="summary-value">{{ formatDuration(todaysTotalTime()) }}</span>
                        <span class="summary-label">Tiempo Total</span>
                      </div>
                    </div>
                    <div class="summary-item">
                      <div class="summary-icon">
                        <mat-icon>timer</mat-icon>
                      </div>
                      <div class="summary-info">
                        <span class="summary-value">{{ todaysTimeEntries().length }}</span>
                        <span class="summary-label">Entradas</span>
                      </div>
                    </div>
                    <div class="summary-item">
                      <div class="summary-icon">
                        <mat-icon>trending_up</mat-icon>
                      </div>
                      <div class="summary-info">
                        <span class="summary-value">{{ todaysEfficiency() }}%</span>
                        <span class="summary-label">Eficiencia</span>
                      </div>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>

            <!-- Time History -->
            <div class="time-history-section">
              <h3>Historial de Hoy</h3>
              <div class="time-entries-list" *ngIf="todaysTimeEntries().length > 0; else noEntries">
                <mat-card *ngFor="let entry of todaysTimeEntries(); trackBy: trackByTimeEntryId"
                          class="time-entry-card"
                          [class.active]="entry.id === currentTimeEntry()?.id"
                          [class.paused]="isTimerPaused() && entry.id === currentTimeEntry()?.id">

                  <mat-card-content>
                    <div class="entry-header">
                      <div class="work-order-info">
                        <span class="work-order-name">{{ getTimeEntryWorkOrderName(entry) }}</span>
                        <span class="entry-time">{{ entry.startAt.toDate() | date:'HH:mm' }} - {{ entry.endAt ? (entry.endAt.toDate() | date:'HH:mm') : 'En curso' }}</span>
                      </div>
                      <div class="entry-duration">
                        <span class="duration">{{ formatDuration(getTimeEntryDuration(entry)) }}</span>
                      </div>
                    </div>

                    <div class="entry-details" *ngIf="entry.pauses && entry.pauses.length > 0">
                      <div class="pause-info">
                        <mat-icon>pause</mat-icon>
                        <span>{{ entry.pauses.length }} pausa(s)</span>
                      </div>
                    </div>

                    <div class="progress-bar" *ngIf="entry.id === currentTimeEntry()?.id">
                      <mat-progress-bar mode="indeterminate" class="active-indicator"></mat-progress-bar>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
              <ng-template #noEntries>
                <div class="no-entries">
                  <mat-icon>history</mat-icon>
                  <p>No hay entradas de tiempo para hoy.</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Métricas">
        <div class="tab-content">
          <!-- Period Selector -->
          <div class="period-selector-section">
            <mat-form-field appearance="outline" class="period-selector">
              <mat-label>Período</mat-label>
              <mat-select [value]="metricsPeriod()" (selectionChange)="onMetricsPeriodChange($event.value)">
                <mat-option value="daily">Diario</mat-option>
                <mat-option value="weekly">Semanal</mat-option>
                <mat-option value="monthly">Mensual</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Loading State -->
          <div *ngIf="loadingStates().metrics || loadingStates().teamMetrics" class="loading-section">
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
            <p>Cargando métricas...</p>
          </div>

          <!-- Error State -->
          <div *ngIf="errorStates().metrics || errorStates().teamMetrics" class="error-section">
            <mat-icon color="warn">error</mat-icon>
            <p>{{ errorStates().metrics || errorStates().teamMetrics }}</p>
          </div>

          <!-- Main Metrics Grid -->
          <div class="metrics-grid" *ngIf="!loadingStates().metrics && !loadingStates().teamMetrics && !errorStates().metrics && !errorStates().teamMetrics">
            <!-- KPI Cards -->
            <mat-card class="kpi-card">
              <mat-card-content>
                <div class="kpi-header">
                  <mat-icon class="kpi-icon">assignment_turned_in</mat-icon>
                  <div class="kpi-info">
                    <span class="kpi-value">{{ currentMetrics()?.completedWorkOrders || 0 }}</span>
                    <span class="kpi-label">Trabajos Completados</span>
                  </div>
                </div>
                <div class="kpi-comparison" *ngIf="personalVsTeamJobs() !== 0">
                  <mat-icon [class.positive]="personalVsTeamJobs() > 0" [class.negative]="personalVsTeamJobs() < 0">
                    {{ personalVsTeamJobs() > 0 ? 'trending_up' : 'trending_down' }}
                  </mat-icon>
                  <span class="comparison-text" [class.positive]="personalVsTeamJobs() > 0" [class.negative]="personalVsTeamJobs() < 0">
                    {{ personalVsTeamJobs() > 0 ? '+' : '' }}{{ personalVsTeamJobs() }} vs promedio equipo
                  </span>
                </div>
              </mat-card-content>
            </mat-card>

            <mat-card class="kpi-card">
              <mat-card-content>
                <div class="kpi-header">
                  <mat-icon class="kpi-icon">schedule</mat-icon>
                  <div class="kpi-info">
                    <span class="kpi-value">{{ formatDuration((currentMetrics()?.totalHoursWorked || 0) * 60) }}</span>
                    <span class="kpi-label">Horas Trabajadas</span>
                  </div>
                </div>
                <div class="kpi-comparison" *ngIf="personalVsTeamHours() !== 0">
                  <mat-icon [class.positive]="personalVsTeamHours() > 0" [class.negative]="personalVsTeamHours() < 0">
                    {{ personalVsTeamHours() > 0 ? 'trending_up' : 'trending_down' }}
                  </mat-icon>
                  <span class="comparison-text" [class.positive]="personalVsTeamHours() > 0" [class.negative]="personalVsTeamHours() < 0">
                    {{ personalVsTeamHours() > 0 ? '+' : '' }}{{ personalVsTeamHours().toFixed(1) }}h vs promedio equipo
                  </span>
                </div>
              </mat-card-content>
            </mat-card>

            <mat-card class="kpi-card">
              <mat-card-content>
                <div class="kpi-header">
                  <mat-icon class="kpi-icon">trending_up</mat-icon>
                  <div class="kpi-info">
                    <span class="kpi-value">{{ currentMetrics()?.efficiencyRate || 0 }}%</span>
                    <span class="kpi-label">Tasa de Eficiencia</span>
                  </div>
                </div>
                <div class="kpi-comparison" *ngIf="personalVsTeamEfficiency() !== 0">
                  <mat-icon [class.positive]="personalVsTeamEfficiency() > 0" [class.negative]="personalVsTeamEfficiency() < 0">
                    {{ personalVsTeamEfficiency() > 0 ? 'trending_up' : 'trending_down' }}
                  </mat-icon>
                  <span class="comparison-text" [class.positive]="personalVsTeamEfficiency() > 0" [class.negative]="personalVsTeamEfficiency() < 0">
                    {{ personalVsTeamEfficiency() > 0 ? '+' : '' }}{{ personalVsTeamEfficiency() }}% vs promedio equipo
                  </span>
                </div>
              </mat-card-content>
            </mat-card>

            <mat-card class="kpi-card">
              <mat-card-content>
                <div class="kpi-header">
                  <mat-icon class="kpi-icon">star</mat-icon>
                  <div class="kpi-info">
                    <span class="kpi-value">{{ customerSatisfaction() | number:'1.1-1' }}</span>
                    <span class="kpi-label">Satisfacción Cliente</span>
                  </div>
                </div>
                <div class="rating-stars">
                  <mat-icon *ngFor="let star of [1,2,3,4,5]" [class.filled]="star <= customerSatisfaction()">
                    star
                  </mat-icon>
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Goals Section -->
          <div class="goals-section" *ngIf="!loadingStates().metrics && currentMetrics()">
            <mat-card class="goals-card">
              <mat-card-header>
                <mat-card-title>Objetivos Mensuales</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="goal-item">
                  <div class="goal-header">
                    <span class="goal-label">Trabajos Completados</span>
                    <span class="goal-progress">{{ monthlyGoals().jobs.current }}/{{ monthlyGoals().jobs.target }}</span>
                  </div>
                  <mat-progress-bar mode="determinate" [value]="goalProgress().jobs" class="goal-progress-bar"></mat-progress-bar>
                </div>

                <div class="goal-item">
                  <div class="goal-header">
                    <span class="goal-label">Horas Trabajadas</span>
                    <span class="goal-progress">{{ monthlyGoals().hours.current.toFixed(1) }}/{{ monthlyGoals().hours.target }}</span>
                  </div>
                  <mat-progress-bar mode="determinate" [value]="goalProgress().hours" class="goal-progress-bar"></mat-progress-bar>
                </div>

                <div class="goal-item">
                  <div class="goal-header">
                    <span class="goal-label">Eficiencia</span>
                    <span class="goal-progress">{{ monthlyGoals().efficiency.current }}/{{ monthlyGoals().efficiency.target }}%</span>
                  </div>
                  <mat-progress-bar mode="determinate" [value]="goalProgress().efficiency" class="goal-progress-bar"></mat-progress-bar>
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Productivity Trends Chart -->
          <div class="trends-section" *ngIf="productivityChartData().length > 0">
            <mat-card class="trends-card">
              <mat-card-header>
                <mat-card-title>Tendencias de Productividad (Últimos 6 meses)</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="chart-placeholder">
                  <div class="chart-legend">
                    <div class="legend-item">
                      <div class="legend-color jobs"></div>
                      <span>Trabajos Completados</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color hours"></div>
                      <span>Horas Trabajadas</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color efficiency"></div>
                      <span>Eficiencia (%)</span>
                    </div>
                  </div>
                  <div class="chart-bars">
                    <div class="chart-bar" *ngFor="let data of productivityChartData(); let i = index">
                      <div class="bar-container">
                        <div class="bar jobs-bar" [style.height.%]="(data.jobs / 30) * 100"></div>
                        <div class="bar hours-bar" [style.height.%]="(data.hours / 200) * 100"></div>
                        <div class="bar efficiency-bar" [style.height.%]="data.efficiency"></div>
                      </div>
                      <span class="bar-label">{{ data.month }}</span>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <!-- Additional Metrics -->
          <div class="additional-metrics-section" *ngIf="currentMetrics()">
            <mat-card class="additional-metrics-card">
              <mat-card-header>
                <mat-card-title>Métricas Adicionales</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="additional-metrics-grid">
                  <div class="metric-item">
                    <span class="metric-label">Tiempo Promedio por Trabajo:</span>
                    <span class="metric-value">{{ currentMetrics()?.averageJobDuration || 0 }} min</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">Trabajos Rehechos:</span>
                    <span class="metric-value">{{ currentMetrics()?.reworkCount || 0 }}</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">Tasa de Puntualidad:</span>
                    <span class="metric-value">{{ currentMetrics()?.onTimeCompletionRate || 0 }}%</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">Tasa de Utilización:</span>
                    <span class="metric-value">{{ currentMetrics()?.utilizationRate || 0 }}%</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Notificaciones">
        <app-employee-notifications [userId]="currentUser()?.id || ''"></app-employee-notifications>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>