<!-- Service Selection Component Template -->

<div class="service-selection-container">
  <!-- Header Section -->
  <div class="step-header">
    <div class="step-icon">
      <span class="icon">{{ getServiceIcon() }}</span>
    </div>
    <h2 class="step-title">{{ flowService.getStepTitle('service') }}</h2>
    <p class="step-description">{{ flowService.getStepDescription('service') }}</p>
  </div>

  <!-- Main Content -->
  <div class="service-selection-section">
    <!-- Filters Section -->
    <div class="filters-card">
      <div class="filters-header">
        <h3>Buscar servicios</h3>
      </div>

      <div class="filters-content">
        <!-- Search Input -->
        <div class="filter-group">
          <label for="searchInput" class="filter-label">Buscar por nombre o c√≥digo</label>
          <div class="search-wrapper">
            <input
              id="searchInput"
              type="text"
              class="search-input"
              placeholder="Ej: cambio de aceite, revisi√≥n..."
              [value]="searchTerm()"
              (input)="onSearchInput($event)">
            <div class="search-icon">
              <span>üîç</span>
            </div>
          </div>
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <label for="categorySelect" class="filter-label">Tipo de servicio</label>
          <select
            id="categorySelect"
            class="category-select"
            [value]="selectedCategory()"
            (change)="onCategoryChange($event)">
            <option value="">Todos los tipos</option>
            @for (category of availableCategories(); track category) {
              <option [value]="category">{{ getServiceTypeLabel(category) }}</option>
            }
          </select>
        </div>

        <!-- Clear Filters -->
        @if (searchTerm() || selectedCategory()) {
          <div class="filter-actions">
            <button
              type="button"
              class="btn-clear-filters"
              (click)="onClearFilters()">
              Limpiar filtros
            </button>
          </div>
        }
      </div>
    </div>

    <!-- Services List -->
    <div class="services-card">
      <div class="services-header">
        <h3>Servicios disponibles</h3>
        <span class="services-count">{{ availableServices().length }} servicios</span>
      </div>

      @if (hasServices()) {
        <div class="services-list">
          @for (service of availableServices(); track service.id) {
            <div
              class="service-item"
              [class.selected]="isServiceSelectedById(service.id)"
              (click)="onServiceSelect(service)">
              <div class="service-main">
                <div class="service-icon">
                  <span class="service-emoji">üîß</span>
                </div>
                <div class="service-info">
                  <h4 class="service-name">{{ getServiceDisplayName(service) }}</h4>
                  <div class="service-meta">
                    <span class="service-type">{{ getServiceTypeLabel(service.type || 'general') }}</span>
                    <span class="service-price">{{ getServicePrice(service) }}</span>
                    <span class="service-duration">{{ getServiceDuration(service) }}</span>
                  </div>
                  @if (service.description) {
                    <p class="service-description">{{ service.description }}</p>
                  }
                </div>
              </div>

              @if (isServiceSelectedById(service.id)) {
                <div class="selection-indicator">
                  <span class="check-icon">‚úÖ</span>
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <div class="no-services-message">
          <span class="no-data-icon">üîç</span>
          <h4>No se encontraron servicios</h4>
          <p>Intenta ajustar los filtros de b√∫squeda</p>
          @if (searchTerm() || selectedCategory()) {
            <button
              type="button"
              class="btn-clear-filters"
              (click)="onClearFilters()">
              Limpiar filtros
            </button>
          }
        </div>
      }
    </div>

    <!-- Selected Service Details -->
    @if (selectedServiceDetails()) {
      <div class="selected-service-card">
        <div class="card-header">
          <span class="selected-icon">‚úÖ</span>
          <h3>Servicio seleccionado</h3>
        </div>

        <div class="service-details">
          <div class="service-summary">
            <h4>{{ selectedServiceDetails()!.title }}</h4>
            <div class="service-summary-meta">
              <span class="summary-price">{{ selectedServiceDetails()!.price }}</span>
              <span class="summary-duration">{{ selectedServiceDetails()!.duration }}</span>
              <span class="summary-type">{{ selectedServiceDetails()!.type }}</span>
            </div>
          </div>

          @if (selectedServiceDetails()!.description) {
            <div class="service-description-full">
              <p>{{ selectedServiceDetails()!.description }}</p>
            </div>
          }

          @if (selectedServiceDetails()!.skills.length > 0) {
            <div class="service-skills">
              <h5>Habilidades requeridas:</h5>
              <div class="skills-list">
                @for (skill of selectedServiceDetails()!.skills; track skill) {
                  <span class="skill-tag">{{ skill }}</span>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Error Message -->
    @if (validationError()) {
      <div class="error-message">
        <span class="error-icon">‚ö†Ô∏è</span>
        {{ validationError() }}
      </div>
    }
  </div>

  <!-- Action Buttons -->
  <div class="action-section">
    <div class="action-buttons">
      <button
        type="button"
        class="btn-secondary"
        (click)="onPrevious()">
        ‚Üê Anterior
      </button>
      <button
        type="button"
        class="btn-primary"
        [disabled]="!isServiceSelected() || isValidating()"
        (click)="onConfirmSelection()">
        @if (isValidating()) {
          <span class="btn-spinner">‚è≥</span>
          Confirmando...
        } @else {
          Continuar
        }
      </button>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-section">
    <div class="progress-bar">
      <div
        class="progress-fill"
        [style.width.%]="flowState().progress">
      </div>
    </div>
    <div class="progress-text">
      Paso 3 de 4 - {{ flowState().progress }}% completado
    </div>
  </div>
</div>